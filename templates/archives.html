{% extends "base.html" %}

{% block title %}Echo Journal Archives{% endblock %}

{% block header_title %}
  <h1 id="welcome-message" class="font-serif font-bold text-[clamp(1.75rem,2vw+1rem,2.5rem)] text-center mb-2 opacity-0">Archive</h1>
{% endblock %}

{% block content %}

<p class="text-sm mt-1 mb-4 text-center text-gray-500 dark:text-gray-400">
  A gentle record of your days â€” grouped for easy reflection.
</p>

<div class="w-full mx-auto">
  {% for period, period_entries in entries.items() %}
    <details class="mt-3 mb-2">
      <summary class="cursor-pointer text-base font-medium">{{ period }}</summary>
      <ul class="mt-1 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-x-2 gap-y-1 text-gray-800 dark:text-gray-100">
        {% for entry_date, prompt in period_entries %}
          <li class="py-1 border-b border-gray-300 dark:border-gray-600 sm:border-none flex items-center space-x-2">
            <a href="/view/{{ entry_date }}" class="text-sm font-medium text-blue-600 visited:text-blue-400 dark:text-blue-400 dark:visited:text-blue-300 hover:underline whitespace-nowrap">{{ entry_date }}</a>
            <span class="text-sm text-gray-600 dark:text-gray-400 truncate">{{ prompt[:75] }}...</span>
          </li>
        {% endfor %}
      </ul>
    </details>
  {% endfor %}
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const animateText = (target, startDelay = 0, letterDelay = 80, wordDelay = 150) => {
    if (!target) return 0;
    const text = target.textContent.trim();
    target.textContent = "";

    let delay = startDelay;
    const tokens = text.split(/(\s+)/);

    tokens.forEach((token) => {
      if (/^\s+$/.test(token)) {
        target.appendChild(document.createTextNode(token));
        return;
      }

      const wordSpan = document.createElement('span');
      wordSpan.style.whiteSpace = 'nowrap';
      wordSpan.style.display = 'inline-block';

      Array.from(token).forEach((ch) => {
        const letter = document.createElement('span');
        letter.textContent = ch;
        letter.className = 'letter-span inline-block opacity-0 transition-opacity duration-200';
        letter.style.transitionDelay = `${delay}ms`;
        delay += letterDelay;
        wordSpan.appendChild(letter);
      });

      delay += wordDelay;
      target.appendChild(wordSpan);
    });

    target.classList.remove('opacity-0');
    requestAnimationFrame(() => {
      target.querySelectorAll('.letter-span').forEach((span) => span.classList.add('opacity-100'));
    });

    return delay;
  };

  const welcomeEl = document.getElementById("welcome-message");
  if (welcomeEl) {
    animateText(welcomeEl, 0, 60, 200);
  }
});
</script>

{% endblock %}
